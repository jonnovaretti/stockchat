<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.7/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/chat", { accessTokenFactory: () => "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6Ikpob24iLCJyb2xlIjoidXNlciIsIm5iZiI6MTYyMTIwNjc2MywiZXhwIjoxNjIxMjEzOTYzLCJpYXQiOjE2MjEyMDY3NjN9.W80rBG7rjvWmZpJBzUP5Tjrt9r2G_-oyidpkGgKs-28" })
            .configureLogging(signalR.LogLevel.Information)
            .build();

        async function start() {
            try {
                await connection.start();
                console.log("websocket connected");
            } catch (err) {
                console.log(err);
                setTimeout(start, 5000);
            }
        };

        connection.onclose(start);
        start();

        connection.on("receiveMessageFromServer", (user, message) => {
            var msg = message.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            var encodedMsg = user + " says " + msg;
            var li = document.createElement("li");
            li.textContent = encodedMsg;
            document.getElementById("messagesList").appendChild(li);
        });

    </script>
    <script>
        function sendMessage() {
            try {
                var message = document.getElementById("message").value;
                connection.invoke("ReceiveMessageFromClient", message);
            } catch (err) {
                console.error(err);
            }
        }
    </script>
</head>
<body>
    <div>
        <textarea cols="50" rows="5" id="message"></textarea>
        <br />
        <button id="sendbutton" onclick="sendMessage()">Send</button>
    </div>
    <br />
    <div>
        <div>
            <ul id="messagesList"></ul>
        </div>
    </div>
</body>
</html>